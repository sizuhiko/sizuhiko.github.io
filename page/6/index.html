<!doctype html>
<html>
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>sizuhiko - Technote</title>
    <link rel="shortcut icon" href="/imgages/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/stylesheets/main.css" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/socialite.min.js"></script>
    <script type="text/javascript" src="http://www.scribd.com/javascripts/scribd_api.js"></script>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />

    <!--[if lte IE 8]>
      <link rel="stylesheet" href="/stylesheets/browsers/ie.css" type="text/css">
      <script src="/javascripts/browsers/ie8.js"></script>
      <script defer src="/javascripts/browsers/ie-css3.js"></script>
    <![endif]-->
    <!--[if IE 6]>
      <link rel="stylesheet" href="/styleseets/browsers/ie6.css" type="text/css">
    <![endif]-->
    <!--[if IE 7]>
      <link rel="stylesheet" href="/styleseets/browsers/ie7.css" type="text/css">
    <![endif]-->
    <!--[if IE 8]>
      <link rel="stylesheet" href="/stylesheets/browsers/ie8.css" type="text/css">
    <![endif]-->
    <style type="text/css">
      @media all and (max-width:680px) {
        #blogtools a, #blogtools a:link, #blogtools a:visited { position:relative; top:0; margin:0 0 5px 10px; float:left; background:#f1f1f1; color:#111; border:1px solid #888; }
        #postcontent, #posttitle { width:100%; }
        #qppreview { display:none; }
        #qpsubmit { width:auto !important; float:none; line-height:1.4; height:auto; margin:7px 0; }
        #postform b { display:block; }
        #sharing { float:none; padding-top:3px; }
        }
    </style>
    <style type="text/css">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .cm {
  color: #999988;
  font-style: italic;
}
.highlight .cp {
  color: #999999;
  font-weight: bold;
}
.highlight .c1 {
  color: #999988;
  font-style: italic;
}
.highlight .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
.highlight .c, .highlight .cd {
  color: #999988;
  font-style: italic;
}
.highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}
.highlight .gd {
  color: #000000;
  background-color: #ffdddd;
}
.highlight .ge {
  color: #000000;
  font-style: italic;
}
.highlight .gr {
  color: #aa0000;
}
.highlight .gh {
  color: #999999;
}
.highlight .gi {
  color: #000000;
  background-color: #ddffdd;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
  font-weight: bold;
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .gt {
  color: #aa0000;
}
.highlight .kc {
  color: #000000;
  font-weight: bold;
}
.highlight .kd {
  color: #000000;
  font-weight: bold;
}
.highlight .kn {
  color: #000000;
  font-weight: bold;
}
.highlight .kp {
  color: #000000;
  font-weight: bold;
}
.highlight .kr {
  color: #000000;
  font-weight: bold;
}
.highlight .kt {
  color: #445588;
  font-weight: bold;
}
.highlight .k, .highlight .kv {
  color: #000000;
  font-weight: bold;
}
.highlight .mf {
  color: #009999;
}
.highlight .mh {
  color: #009999;
}
.highlight .il {
  color: #009999;
}
.highlight .mi {
  color: #009999;
}
.highlight .mo {
  color: #009999;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #009999;
}
.highlight .sb {
  color: #d14;
}
.highlight .sc {
  color: #d14;
}
.highlight .sd {
  color: #d14;
}
.highlight .s2 {
  color: #d14;
}
.highlight .se {
  color: #d14;
}
.highlight .sh {
  color: #d14;
}
.highlight .si {
  color: #d14;
}
.highlight .sx {
  color: #d14;
}
.highlight .sr {
  color: #009926;
}
.highlight .s1 {
  color: #d14;
}
.highlight .ss {
  color: #990073;
}
.highlight .s {
  color: #d14;
}
.highlight .na {
  color: #008080;
}
.highlight .bp {
  color: #999999;
}
.highlight .nb {
  color: #0086B3;
}
.highlight .nc {
  color: #445588;
  font-weight: bold;
}
.highlight .no {
  color: #008080;
}
.highlight .nd {
  color: #3c5d5d;
  font-weight: bold;
}
.highlight .ni {
  color: #800080;
}
.highlight .ne {
  color: #990000;
  font-weight: bold;
}
.highlight .nf {
  color: #990000;
  font-weight: bold;
}
.highlight .nl {
  color: #990000;
  font-weight: bold;
}
.highlight .nn {
  color: #555555;
}
.highlight .nt {
  color: #000080;
}
.highlight .vc {
  color: #008080;
}
.highlight .vg {
  color: #008080;
}
.highlight .vi {
  color: #008080;
}
.highlight .nv {
  color: #008080;
}
.highlight .ow {
  color: #000000;
  font-weight: bold;
}
.highlight .o {
  color: #000000;
  font-weight: bold;
}
.highlight .w {
  color: #bbbbbb;
}
.highlight {
  background-color: #f8f8f8;
}
    </style>
    <script type="text/javascript">
      $(document).ready(function() {
        Socialite.load("blog-social");
      });
    </script>

  </head>
  <body id="myopera" data-twttr-rendered="true">
    <!--[if IE 6]><div class="ie6"><![endif]-->
    <!--[if IE 7]><div class="ie7"><![endif]-->
    <!--[if IE 8]><div class="ie8"><![endif]-->
    <!--[if IE 9]><div class="ie9"><![endif]-->
    <div id="wrap0"><div id="wrap1"><div id="wrap2"><div id="wrap3"><div id="wrap4">

    <div id="top" class="top-blog">
      <div id="top2">
        <h1><a href="/" title="home"><span>Technote</span></a></h1>
        <p id="subtitle"><span>by sizuhiko</span></p>
      </div>
    </div>

    <div id="content" class="blogfront">
      <div id="mainwrap">
        <div id="main">
          

            <h2 class="title"><a href="/2012/05/01/querypath-html.html">QueryPathを使ってHTMLを操作する</a></h2>
  <p class="postdate"><a title="Permanent link" href="/2012/05/01.html">Tuesday, May 01, 2012 03:05:12 PM</a></p>
  <p class="tags">
    
      <a rel="tag" href="/tags/html.html">HTML</a>
    
      <a rel="tag" href="/tags/php.html">PHP</a>
    
      <a rel="tag" href="/tags/querypath.html">QueryPath</a>
    
  </p>
  <div class="content">
    <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
    <p>&lt;!&ndash; more &ndash;&gt;昨年末phpQueryについて、これはいいね！と取り上げたのですが、その時点でも若干更新が止まっていたり、XHTMLの解釈が微妙だったりとかいくつか不安要因があったのですが、そんな不安を解消するjQueryインターフェースを実装したライブラリを発見しました。  </p>

<p>それが<a href="http://querypath.org/">QueryPath</a>です。
<img src="/images/blog/querypath_logo.png" /> </p>

<h3>QueryPathが当たり前に良いと思う点</h3>

<ul>
<li>日本語が普通に使える</li>
<li>XHTMLが普通に使える</li>
<li>更新されている</li>
<li>拡張（extension）が書きやすい</li>
<li>テストコードがある</li>
<li>jQueryインターフェースがほぼ忠実に再現されている</li>
</ul>

<p>こういう当たり前にできて欲しい事が、意外と日本語環境だとうまくできなかったりするのですが、特に意識することなくできるのは良いと思います。
もちろんmetaの文字コード指定など、ある程度ちゃんとHTMLが書かれている事は重要です。</p>

<h3>QueryPathが独特と思う点</h3>

<p>QueryPathは標準で5つの拡張機能（extension）を持っています。</p>

<ul>
<li>QPDB : データベースへのアクセスと、検索結果をテンプレートへの差し込むことができるようになる</li>
<li>QPList：配列で渡した内容をtableタグやul、olなどに展開してHTML化できる</li>
<li>QPTPL：連想配列のキーをidやclassなどのクエリ情報と解釈して、テンプレート流し込み機能を提供する</li>
<li>QPXML：XMLを操作する拡張機能</li>
<li>QPXSL：XSLTを利用する拡張機能</li>
</ul>

<p>独特というのは、拡張機能が簡単に実装できるので、拡張を使えばこんな事、あんな事、jQueryプラグインを書くかのように自由にできますよ、という部分に集約されると思います。</p>

<h3>使ってみよう</h3>

<h4>インストール</h4>

<p>QueryPathは3つの導入方法に対応しています。</p>

<ul>
<li>PEARパッケージ</li>
<li>pharファイル</li>
<li>Composer</li>
</ul>

<p>ここではpharファイルをダウンロードして始めてみます。pharファイル以外の導入方法は<a href="https://github.com/technosophos/querypath">GitHubの公式ページ</a>を参照してください。  </p>

<p><a href="https://github.com/technosophos/querypath/downloads">ダウンロードページ</a>より QueryPath-<em>version</em>.pharというファイルをダウンロードします。この記事時点での最新versionは2.1.2です。ダウンロードしたファイルの名前をQueryPath.pharにリネームしておきます。</p>

<h4>サンプルHTMLの取得</h4>

<p>前回のphpQueryと同じく、WORDPRESSの日本語TOPページのHTMLを使ってみたいと思います。</p>
<pre class="highlight plaintext">wget http://ja.wordpress.org/
</pre>

<h4>phpshを使って試す</h4>

<p>こちらも前回と同様に、簡単に試すにはインタラクティブシェルを使うのが便利なので、phpshを使います。</p>
<pre class="highlight plaintext">bash-3.2$ phpsh
Starting php
type 'h' or 'help' to see instructions &amp; feature

php&gt; require 'QueryPath.phar';

php&gt; $html = htmlqp('index.html');

php&gt; = $html-&gt;find('#blog .post .entry')-&gt;eq(0)-&gt;text()
"ntttttttttWordPress 3.3.2 が利用できるようになりました。これはすべての前バージョンへのセキュリティアップデートです。nWordPress に含まれる3つの外部ライブラリでセキュリティアップデートがありました:n    Plupload (バージョン 1.5.4)、WordPress ではメディアのアップロードに使用しています。n    SWFUpload、WordPress では以前にメディアのアップロードに使用していました。おそらくプラグインによってはまだ使われています。n    SWFObject、WordPress では以前に Flash コンテンツの埋め込みに使用していました。おそらくプラグインやテーマによってはまだ使われています。ntttttttt"
</pre>

<p>ブログエントリーの先頭記事を抜き出してみました。phpQueryは配列キーにセレクタを記述する方式だったのですが、QueryPathではPHP言語としての「-&gt;」の部分以外はjQueryと同じだとわかるでしょう。
またQueryPathにはqpというコア関数もあるのですが、こちらはXML用で、HTMLを利用する場合はhtmlqpを使っておいた方が良さそうです。  </p>

<p>最後に</p>
<pre class="highlight plaintext">php&gt; = $html-&gt;top()-&gt;html();
</pre>

<p>を実行すると、HTML全文を文字列として取得することができます。日本語がまったく問題ないことを確認できると思います。  </p>

<p>※ $html-&gt;top()-&gt;innerXHTML(); ではなく、html関数でないと htmlタグとか含まれないので修正しました。(5/7)</p>

<h3>まとめ</h3>

<p>現時点でもHTMLの取得にはURL指定、ファイル指定など様々な対応がされており、DB連携やテンプレート機能などそのままでも結構つかえるんじゃないかと思っています。  </p>

<p>ただ毎度DOM操作するの？とかいう部分もあるとは思うので、phpQueryっぽいPHP構文が含まれたPHPファイルを出力できるような拡張を作ってみたいなと思っています。まずは素のPHP部分から、その後でCakePHPとの連携も含んでみたいなぁという計画です。拡張名は標準のものを参考にするとQPPHP？なのかな。Pが続くと見づらいなぁ。名前は大事なので何か考えないと。。。</p>



    
    <div class="row">
      <div class="small-12 medium-5 large-5 small-centered columns blog-social">
        <ul class="social-buttons cf">
          <li>
            <a href="http://twitter.com/share" class="socialite twitter-share" data-text="QueryPathを使ってHTMLを操作する" data-url="http://blog.open.tokyo.jp/2012/05/01/querypath-html.html" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
          </li>
          <li>
            <a href="https://plus.google.com/share?url=http://blog.open.tokyo.jp/2012/05/01/querypath-html.html" class="socialite googleplus-one" data-size="tall" data-href="http://blog.open.tokyo.jp/2012/05/01/querypath-html.html" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
          </li>
          <li>
            <a href="http://www.facebook.com/sharer.php?u=http://blog.open.tokyo.jp/2012/05/01/querypath-html.html&t=QueryPath%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6HTML%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%99%E3%82%8B" class="socialite facebook-like" data-href="http://blog.open.tokyo.jp/2012/05/01/querypath-html.html" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
          </li>
        </ul>
      </div>
      <div class="clearfix"></div>
    </div>

  </div>
  <h2 class="title"><a href="/2011/12/25/phpquery.html">phpQueryを使ってデザイナーとプログラマーを完全分業できるようにする（導入編）</a></h2>
  <p class="postdate"><a title="Permanent link" href="/2011/12/25.html">Sunday, December 25, 2011 02:12:34 PM</a></p>
  <p class="tags">
    
      <a rel="tag" href="/tags/php.html">PHP</a>
    
      <a rel="tag" href="/tags/phpquery.html">phpQuery</a>
    
  </p>
  <div class="content">
    <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
    <p>&lt;!&ndash; more &ndash;&gt;これまで多くのテンプレートエンジンが登場してきましたが、HTMLに全く手を入れないでデザイナーとプログラマーが分業することは困難でした。
もちろんSmartyのテンプレートが編集できる人がいたり、PHPTALのようにほとんどHTMLには手をつけない方法があったりと、これまでの方法でも分業することは可能だと思います。  </p>

<p>ただHTMLには多少の手を入れなくてはいけない、そういう意味でKwartzのようにプレゼンテーションロジックを分割できるテンプレートシステムはとても良いと思っています。ただセレクターがCSS3セレクターでないのが難点かなぁと思っています。  </p>

<p>そこで目を付けたのが<a href="http://code.google.com/p/phpquery/">phpQuery</a>という、名前からして思い当たるjQueryのセレクター機能を搭載したPHP実装になっています。  </p>

<p>phpQueryは内部的にPHPのDOMDocumentを使っていて、エレメントを探し出すのに便利なセレクター記法を持っています。  </p>

<p>今回はphpQueryを使って静的HTMLの一部をPHPコードに書き換えるという導入をやってみます。  </p>

<p>本当は時間があればViewコンポーネントまで作って、githubに展開したかったのですが、これは2012年早々の目標になる予定です。  </p>

<h3>phpQueryの取得</h3>

<p>phpQueryは</p>

<ol>
<li>pear</li>
<li>google-code</li>
<li>github</li>
</ol>

<p>のいずれかから導入可能です。この記事ではgithubから取得して進めます。</p>
<pre class="highlight plaintext">git clone git://github.com/bluelovers/phpQuery.git
</pre>

<h3>サンプルHTMLの取得</h3>

<p>この記事では、みんな大好きWORDPRESSの日本語TOPページのHTMLを使ってみたいと思います。  </p>
<pre class="highlight plaintext">mkdir templates
wget http://ja.wordpress.org/
mv index.html templates
</pre>

<p>ここで注意なのですが、現在DOMDocumentではXHTMLを正しくパースできないようです。そこで、通常のHTMLとして解釈できるように先頭数行を以下のように書き換えます。</p>
<pre class="highlight html"><span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
</pre>

<p>DOCTYPEを削除し、htmlとheadにあった属性を削除しています。  </p>

<p>ただXHTMLでなくHTML記法で書かれたページは問題ないので、この課題についてはあまり深入りせず先に進む事にします。  </p>

<p>ただDOCTYPEや属性は、後で追加できるのでViewクラスにしたときに何かサポートできるようにしたいなぁと思っています。  </p>

<p><img src="/images/blog/WordPress.png" /> </p>

<p>の赤枠で囲った部分に関して、PHPの動的コードに変換してみましょう。  </p>

<h3>phpshを使って試す</h3>

<p>簡単に試すにはインタラクティブシェルを使うのが便利なので、今回もphpshを使います。  </p>
<pre class="highlight plaintext">bash-3.2$ phpsh
Starting php
type 'h' or 'help' to see instructions &amp; features

php&gt; require('phpQuery/phpQuery/phpQuery.php');
php&gt; $file = file_get_contents('template/index.html');
php&gt; $html = phpQuery::newDocumentHTML($file);
php&gt; echo $html-&gt;html();
</pre>

<p>最後のhtml()で読み込んだHTMLがそのまま出力されることを確認しましょう。  </p>

<p>ブログ記事の箇所のHTMLは以下のようになっています。  </p>
<pre class="highlight plaintext">&lt;div id="blog" class="section"&gt;
  &lt;div class="main"&gt;
    &lt;h3&gt;ブログ&lt;/h3&gt;
    &lt;div class="post" id="post-2057"&gt;
    &lt;h4&gt;&lt;a href="http://ja.wordpress.org/2011/12/13/wordpress-3-3-ja/" rel="bookmark" title="WordPress 3.3 日本語版リリースのお知らせ へのパーマリンク"&gt;WordPress 3.3 日本語版リリースのお知らせ&lt;/a&gt;&lt;/h4&gt;
    &lt;h6&gt;2011年12月13日&lt;/h6&gt;
    &lt;div class="entry"&gt;
      &lt;p&gt;WordPress 3.3 日本語版をリリースしました。&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class="post" id="post-2042"&gt;
    &lt;h4&gt;&lt;a href="http://ja.wordpress.org/2011/12/13/wordpress-3-3-sonny/" rel="bookmark" title="WordPress 3.3「Sonny」 へのパーマリンク"&gt;WordPress 3.3「Sonny」&lt;/a&gt;&lt;/h4&gt;
    &lt;h6&gt;2011年12月13日&lt;/h6&gt;
    &lt;div class="entry"&gt;
      &lt;p&gt;WordPress 3.3「Sonny」がご利用いただけるようになりました。&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
</pre>

<p>ブログ記事は $posts という配列に入っていると仮定します。</p>
<pre class="highlight plaintext">php&gt; $html['#blog .post:gt(0)']-&gt;remove();
php&gt; $html['#blog .post']-&gt;wrapPHP('foreach($posts as $post) {', '}');
php&gt; $html['#blog .post']-&gt;attrPHP('id', 'echo "post-$post-&gt;id;"');
php&gt; $html['#blog .post h4 a']-&gt;attrPHP('href', 'echo $post-&gt;url;')-&gt;attrPHP('title', 'echo $post-&gt;title;')-&gt;php('echo $post-&gt;title;');
php&gt; $html['#blog .post h6']-&gt;php('echo $post-&gt;date;');
php&gt; $html['#blog .post .entry p']-&gt;php('echo $post-&gt;intro;');

php&gt; print $html-&gt;php();                                                                                             
</pre>

<p>のようにphpshで実行すると、先ほどのHTML部分が以下のようになります。</p>
<pre class="highlight plaintext">&lt;div id="blog" class="section"&gt;
  &lt;div class="main"&gt;
    &lt;h3&gt;ブログ&lt;/h3&gt;
    &lt;?php  foreach($posts as $post) {  ?&gt;
      &lt;div class="post" id='&lt;?php  echo "post-$post-&gt;id";  ?&gt;'&gt;
        &lt;h4&gt;&lt;a href="&lt;?php  echo $post-&gt;url;  ?&gt;" rel="bookmark" title="&lt;?php  echo $post-&gt;title;  ?&gt;"&gt;&lt;?php  echo $post-&gt;title;  ?&gt;&lt;/a&gt;&lt;/h4&gt;
        &lt;h6&gt;&lt;?php  echo $post-&gt;date;  ?&gt;&lt;/h6&gt;
        &lt;div class="entry"&gt;
          &lt;p&gt;&lt;?php  echo $post-&gt;intro;  ?&gt;&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;?php  }  ?&gt;
  &lt;/div&gt;
</pre>

<p>どうです？  </p>

<p>jQueryで見慣れたセレクタ記述と、少しのphpQueryの拡張記述で、HTMLを直接変更することなくPHPコードを含んだテンプレートファイルに変換することができました。  </p>

<p>phpQueryが用意している<a href="http://code.google.com/p/phpquery/wiki/Selectors">jQueryポートしたセレクタ</a>や、<a href="http://code.google.com/p/phpquery/wiki/PHPSupport">PHPコードを出力する拡張関数</a>は、<a href="http://code.google.com/p/phpquery/">google-codeの公式ページ</a>を参照するとわかります。</p>

<h3>さいごに</h3>

<p>最初にHTMLファイルを読み込む部分や、最後にphp()関数を使ってPHPを含むコードに変換する部分をモジュール化して、各フレームワーク向けのViewコンポーネントとして提供したいなぁと思っています。  </p>

<p>ただ普段使っているのがCakePHPばかりなので、他のフレームワークについてわかる人に協力してもらえたらなぁと思っています。  </p>

<p>またViewコンポーネントにする際は<a href="http://code.google.com/p/querytemplates/">QueryTemplates</a>というphpQueryを拡張したコードも使おうかなぁと思っています。</p>



    
    <div class="row">
      <div class="small-12 medium-5 large-5 small-centered columns blog-social">
        <ul class="social-buttons cf">
          <li>
            <a href="http://twitter.com/share" class="socialite twitter-share" data-text="phpQueryを使ってデザイナーとプログラマーを完全分業できるようにする（導入編）" data-url="http://blog.open.tokyo.jp/2011/12/25/phpquery.html" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
          </li>
          <li>
            <a href="https://plus.google.com/share?url=http://blog.open.tokyo.jp/2011/12/25/phpquery.html" class="socialite googleplus-one" data-size="tall" data-href="http://blog.open.tokyo.jp/2011/12/25/phpquery.html" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
          </li>
          <li>
            <a href="http://www.facebook.com/sharer.php?u=http://blog.open.tokyo.jp/2011/12/25/phpquery.html&t=phpQuery%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%87%E3%82%B6%E3%82%A4%E3%83%8A%E3%83%BC%E3%81%A8%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9E%E3%83%BC%E3%82%92%E5%AE%8C%E5%85%A8%E5%88%86%E6%A5%AD%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B%EF%BC%88%E5%B0%8E%E5%85%A5%E7%B7%A8%EF%BC%89" class="socialite facebook-like" data-href="http://blog.open.tokyo.jp/2011/12/25/phpquery.html" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
          </li>
        </ul>
      </div>
      <div class="clearfix"></div>
    </div>

  </div>
  <h2 class="title"><a href="/2011/12/03/cakebehat-master-cakephp2-0-selenium.html">CakeBehat の master を CakePHP2.0 対応に切り替えました。Seleniumによるテストも簡単に。</a></h2>
  <p class="postdate"><a title="Permanent link" href="/2011/12/03.html">Saturday, December 03, 2011 05:12:14 PM</a></p>
  <p class="tags">
    
      <a rel="tag" href="/tags/behat.html">Behat</a>
    
      <a rel="tag" href="/tags/cakephp.html">CakePHP</a>
    
      <a rel="tag" href="/tags/selenium.html">Selenium</a>
    
  </p>
  <div class="content">
    <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
    <!-- more -->

<h2>CakeBehat for CakePHP2.0</h2>

<p>PHPMatsuri 2011 で完了させた CakePHP2.0 対応ですが、しばらく 2.0 ブランチで開発バージョンとして扱っていたものを最新のCakePHP,Behat,Minkで動作確認してmasterに昇格させました。</p>

<p><a href="https://github.com/sizuhiko/CakeBehat">https://github.com/sizuhiko/CakeBehat</a></p>

<h2>はじめに</h2>

<p>CakeBehatはCakePHPからBehatを呼び出してテストするためのプラグインです。CakePHP1.3対応として公開したのが2011年6月投稿です。  </p>

<p><a href="http://my.opera.com/sizuhiko/blog/2011/06/20/cakephp-behat">http://my.opera.com/sizuhiko/blog/2011/06/20/cakephp-behat</a></p>

<h2>インストール</h2>

<h3>前提事項</h3>

<ol>
<li>gitが利用可能なこと</li>
<li>PHPUnitがインストールされていること</li>
<li>CakePHP2.0.xがインストールされていること</li>
<li>MySQLなどデータベースがインストールされていて、テスト用データベースが準備されていること</li>
</ol>

<h3>導入</h3>

<p>CakePHPのルートディレクトリへ移動して、以下のコマンドを実行してください。</p>
<pre class="highlight plaintext">cd plugins
git clone git@github.com:sizuhiko/CakeBehat.git
cd ..
</pre>

<p>すると、plugins 配下に CakeBehat のディレクトリができているはずです。CakeBehatプラグインを有効にするためにbootstrapでプラグインの読み込みを行います。  </p>
<pre class="highlight plaintext">app/Config/bootstrap.phpの最後に追加します。
....

CakePlugin::load('CakeBehat');
</pre>

<p>次に、CakeBehatで必要なBehatやMinkをダウンロードし、featues を初期化します。CakePHPのルートディレクトリに移動して、以下のコマンドを実行します。  </p>
<pre class="highlight plaintext">lib/Cake/Console/cake CakeBehat.init
</pre>

<p>するとCakePHPのルートディレクトリに featues ディレクトリができているはずです。
その他にplugins/CakeBehat/Console/Command の下に behat.phar と mink.phar がダウンロードされます。</p>

<h2>環境設定</h2>

<h3>Behat/Mink環境設定</h3>

<p>app/Config/behat.yml がinitコマンドによって生成されています。  </p>

<p>５行目に</p>
<pre class="highlight plaintext">base_url: http://test.localhost:8888/application-name/
</pre>

<p>という設定があります。これはアプリケーションのルートパスを設定するもので、ホスト名、ポート番号、アプリケーション名などを指定します。ホスト名はできるだけtest環境と識別可能なものにしておく事がオススメです。</p>

<h2>実行する</h2>

<p>基本的な環境設定は、ここまでで、behatは実行可能な状況になっています。
具体的にサンプルアプリケーションのコードを使っての解説は、以前のPostと同じなので、以下のURLから確認してください。  </p>

<p><a href="http://my.opera.com/sizuhiko/blog/2011/06/20/cakephp-behat">http://my.opera.com/sizuhiko/blog/2011/06/20/cakephp-behat</a></p>

<p>ただし実行コマンドがプラグイン化に伴って変更されています。プラグイン名が付いたので、cake behat というシンプルなものからは少し遠くなってしまいましたが、以下のコマンドを実行してください。</p>
<pre class="highlight plaintext">lib/Cake/Console/cake CakeBehat.bdd
</pre>

<h2>Ajaxを利用したページをテストしたい</h2>

<p>最新版のMinkでは、Ajaxを使ったページをテストできるように、ブラウザエンジンを選択することができるようになっています。</p>

<ol>
<li>GoutteDriver : Ajaxは使えないがライトなブラウザテストが可能</li>
<li>SahiDriver：ブラウザのプロキシ設定が必要だが、様々なブラウザでテストが可能</li>
<li>ZombieDriver：Node.js を使ったブラウザテストが可能</li>
<li>SeleniumDriver：Mink1.2 からサポートされた、お馴染みのSeleniumによるテストが可能</li>
</ol>

<p>公式のBehatやMinkのドキュメントを参照すると、Seleniumなどを使う場合の方法が書いていませんコードを書いて初期化しないといけませんが、Behat+Minkのインテグレーションでは、behat.ymlに設定するだけで簡単にSeleniumによるテストが実行できるようになります。</p>

<h3>JavaScriptセッションエンジンを指定する</h3>

<p>CakeBehatではデフォルトのJavaScriptセッションエンジンをSeleniumとしています。app/Config/behat.yml の 4行目に</p>
<pre class="highlight plaintext">javascript_session:   selenium
</pre>

<p>設定を入れてあります。まだ試していませんが、sahiやzombieを使う場合はこの設定を変更すれば動作するはずです。</p>

<h3>JavaScriptを使ったページをテストしたいシナリオでは</h3>

<p>@javascript アノテーションをfeatureに指定します。</p>

<p>サンプルアプリケーション（blogチュートリアル）のindex.ctpでDeleteボタンがクリックされたときにtrエレメントを消すだけの実装を追加してみました。<a href="https://github.com/sizuhiko/CakeBehat/blob/master/sample/app/View/Posts/index.ctp">app/View/Posts/index.ctp</a>で</p>
<pre class="highlight plaintext">&lt;td&gt;&lt;a href="javascript:void(0);" onclick="$(this).closest('tr').remove();"&gt;Delete&lt;?php echo $index++; ?&gt;&lt;/a&gt;
</pre>

<p>のようにしました。  </p>

<p>このリンク「Delete3」をクリックして3行目を削除するfeatureを書きます。</p>
<pre class="highlight plaintext">  @javascript
  シナリオ: 記事を削除できること
    前提 "トップページ" を表示している
    かつ "Title strikes back" と表示されていること
    もし "Delete3" のリンク先へ移動する
    ならば "Title strikes back" と表示されていないこと
</pre>

<p>「リンクをクリックする」みたいなステップへ書き換えた方が本当は直感的なのですが、とりあえず「リンク先へ移動する」を使っています。  </p>

<p>後は、Seleniumを実行しておくだけです。</p>
<pre class="highlight plaintext">java -jar selenium-server-standalone-2.14.0.jar 
</pre>

<p>これだけです。特にSeleniumを使うと意識しなくても、@javascriptを付けたシナリオだけでFirefoxが起動してテストが実行されます。もちろんこのJavaScriptを使ったテストも成功します。</p>

<h2>さいごに</h2>

<p>BehatやMinkは少しのバージョンアップ違いでうまく動かないケースがあります。もしCakeBehatを使ってうまく動作しないケースなどはgithubのissueなどに書き込んでいただければ、改善していきたいと思っていますのでよろしくお願いします。</p>



    
    <div class="row">
      <div class="small-12 medium-5 large-5 small-centered columns blog-social">
        <ul class="social-buttons cf">
          <li>
            <a href="http://twitter.com/share" class="socialite twitter-share" data-text="CakeBehat の master を CakePHP2.0 対応に切り替えました。Seleniumによるテストも簡単に。" data-url="http://blog.open.tokyo.jp/2011/12/03/cakebehat-master-cakephp2-0-selenium.html" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
          </li>
          <li>
            <a href="https://plus.google.com/share?url=http://blog.open.tokyo.jp/2011/12/03/cakebehat-master-cakephp2-0-selenium.html" class="socialite googleplus-one" data-size="tall" data-href="http://blog.open.tokyo.jp/2011/12/03/cakebehat-master-cakephp2-0-selenium.html" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
          </li>
          <li>
            <a href="http://www.facebook.com/sharer.php?u=http://blog.open.tokyo.jp/2011/12/03/cakebehat-master-cakephp2-0-selenium.html&t=CakeBehat%20%E3%81%AE%20master%20%E3%82%92%20CakePHP2.0%20%E5%AF%BE%E5%BF%9C%E3%81%AB%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%81%BE%E3%81%97%E3%81%9F%E3%80%82Selenium%E3%81%AB%E3%82%88%E3%82%8B%E3%83%86%E3%82%B9%E3%83%88%E3%82%82%E7%B0%A1%E5%8D%98%E3%81%AB%E3%80%82" class="socialite facebook-like" data-href="http://blog.open.tokyo.jp/2011/12/03/cakebehat-master-cakephp2-0-selenium.html" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
          </li>
        </ul>
      </div>
      <div class="clearfix"></div>
    </div>

  </div>
  <h2 class="title"><a href="/2011/10/20/phpmatsuri-3.html">PHPMatsuriで"できたこと"</a></h2>
  <p class="postdate"><a title="Permanent link" href="/2011/10/20.html">Thursday, October 20, 2011 05:10:21 PM</a></p>
  <p class="tags">
    
      <a rel="tag" href="/tags/osaka.html">osaka</a>
    
      <a rel="tag" href="/tags/php.html">PHP</a>
    
      <a rel="tag" href="/tags/phpmatsuri.html">phpmatsuri</a>
    
      <a rel="tag" href="/tags/titanium.html">Titanium</a>
    
  </p>
  <div class="content">
    <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
    <p>&lt;!&ndash; more &ndash;&gt;<a href="http://www.flickr.com/photos/koyhoge/6247049544/"><img alt="DSC05649" src="http://farm7.static.flickr.com/6235/6247049544_3f37a2af25.jpg" /></a></p>

<h3>大事なことは最初に</h3>

<p><a href="http://2011.phpmatsuri.net/">PHPMatsuri 2011</a>は昨年に続き、多くの参加者に恵まれまして、無事終了することができました。今年は幹事的な立場で進めてきたのですが、大勢のスタッフやスポンサー、参加者の皆様に支えられたことを感謝しています。  </p>

<p>人数もスタッフ、ゲスト、参加者合わせて目標としていた100名に近い96名と、ほぼ満員御礼で開催できたことがとても嬉しいです。  </p>

<p>さて今回は、イベント開催前にリレーブログ「<a href="http://my.opera.com/sizuhiko/blog/2011/09/28/phpmatsuri">PHPMatsuriに参加するとできること</a>」で書いた内容をふりかえる形で開催/参加報告にしたいと思います。</p>

<h3>とにかく聴いてみる</h3>

<p><a href="http://www.flickr.com/photos/koyhoge/6247023308/"><img alt="DSC05620" src="http://farm7.static.flickr.com/6233/6247023308_06662b7015.jpg" /></a>  </p>

<p>初日は午前中から、夜の闇PHPMatsuriまでとても濃いセッションが展開されました。昨年は「ハッカソンで何かを作る」というよりは講演スペースで聴く人の割合が多かったのですが、今年は聴講中心という人の割合よりも、ワークショップとセッションへ交互に参加するという、より幅広くイベントを楽しむスタイルの人が多かったと思います。  </p>

<p>夜には昨年はJIREIマスターか登場したのですが、今年は闇の者（NINJA）が登場し、会場を盛り上げていました。闇PHPMatsuriは当初プログラム計画にない持ち込み企画だったのですが、闇の皆様には大変感謝しています。海外のゲストもとても楽しんでいたと思います。  </p>

<p>2日目の発表LT大会でも、昨年とほぼ同数の40名近くの参加者がPHPMatsuriでの体験を発表。このLTが中盤にさしかかった休憩時間には「<strong>今回イベントとか初参加なのですけど、LTを見て作ったものを発表してみたいな、と思うのですが（エントリーしていないけど）これから可能ですか？</strong>」という声をいただき、審査時間の間にリジェクトトーク時間を急遽作りました。これは昨年になかったサプライズで、スタッフのshin1x1さんや、多くの方が「まぁ発表しなくても良いかな？」から「発表したい」に変わっていく瞬間を見れたことはスタッフとして嬉しいことです。リジェクトトークの時間はおよそ30分ぐらいあったのですが、賞品がもらえる訳でもないこの時間に隙間無く発表者が飛び入り参加したのは、PHPMatsuriの中毒症状というか、始めてイベントに参加した人にとっても、これから他のイベントに参加するきっかけになったのではないかと思っています。  </p>

<p>また通常のスポンサード以外にも、初日の15時ティータイムにスイーツの差し入れをしてくれた「<a href="http://wattaina.com/">わったい菜</a>」のスイーツが絶品でした。  </p>

<h3>何か作ってみたい</h3>

<p><img src="/images/blog/hack_night_tl.png" /> 初日の昼間の状況は前述したとおりですが、各フレームワークのワークショップも大変盛況でした。昨年は時間が近くなったら何となく集まってやっていたワークショップも、今年は「どこでやりますか？」「すぐ始まりますか？」など参加者の意欲がとても熱く、最初はスタッフもバタバタしてしまい申し訳なかったなぁと思いました。ワークショップに関して今年は特に熱かった（部屋の温度が暑かったのは参加者の熱気では？と思うぐらい）！  </p>

<p>また、そこかしこでは、明日の発表に向けて黙々と作っている人などもいて、それぞれの祭りを楽しんでいる様子が伺えました。  </p>

<p>それを証明するのが、増井さんと有志の方が定点カメラで撮影した深夜の様子。昨年はほとんどいなかった貫徹組が今年はとても多かったのがビックリでした。コアデベロッパーも質問が来るかもしれないからと、ずっと起きてくれていたのにも感謝です。</p>

<h3>他の人と一緒に作ってみたい</h3>

<p>残念ながらまだ他の人と一緒に作ってみて発表、というところまでは中々難しいですね。ただポジションペーパーに協力いただいたのは嬉しかったです。少しずつ、昨年よりも今年の盛り上がりが熱かったように、共同製作のようなことが来年以降あるのではないかと期待しています。</p>

<h3>長い夜の過ごし方</h3>

<p><a href="http://www.flickr.com/photos/koyhoge/6247070944/"><img alt="DSC05675" src="http://farm7.static.flickr.com/6049/6247070944_969d0127eb.jpg" /></a>  </p>

<p>今年の会場はとても広く、会場の外でも開発を続ける様子が見受けられました。隣のビジネスコーナーや、談話室、はたまたマッサージチェアでといった具合に自分に合った?!スタイルで開発をしていたのが印象的でした。  </p>

<p>夜のテストワークショップに至っては時間を延長して4時間以上やっていたり、スポンサーセッションがあったり、闇の忍者が現れたりと。  </p>

<p>その後深夜はアングリーバードのゲーム大会が行われていたり、例のEpic Saxが流れていたり、ともかく様々な楽しみ方で盛り上がっていました。</p>

<h3>何でも良いので発表してみよう</h3>

<p><a href="http://www.flickr.com/photos/koyhoge/6254425900/"><img alt="DSC05804" src="http://farm7.static.flickr.com/6211/6254425900_822e6851aa.jpg" /></a>  </p>

<p>そして多いに盛り上がったLT大会。あれほど接続テストをしたのに、いざ本番でうまく画面がでなかったり、緊張でタイマーを見てなくて一番大事なところで発表が終わったり（これは関東のLTでは一番盛り上がるネタ手法）、キモいw 発表があったりと、あっという間に3時間が過ぎたのではないかと思います。  </p>

<p>もちろん前述したとおりリジェクトトークもあり、ビールタイムもありで、盛りだくさんではなかったかと。  </p>

<p>後は今年もsioさんにドラ娘を任せっきりになってしまって、皆さんドラ娘も貴重な機会なので叩いてみるといいよ、と思うのですがなかなかに難しいですね。一度叩くとこれも中毒になるものなので、ぜひ来年はドラ娘に協力していただける方がいるといいなぁと思っています。</p>

<h3>最後に</h3>

<p>すでにここまでにも嬉しかった事などを書いたのですが、ちょっと書ききれなかったところでもあるので2つほど印象に残っていたことを紹介します。</p>

<ol>
<li>CakePHPで何か作ろうと思って参加したけど、Titanium が面白そうでそちらで作ったものを発表します、という発表があった。これはPHPMatsuriのようにセッションやワークショップがあった効果だと思っています。また参加者の人が通常仕事では出会う場面がなかったかもしれない、新たな発見をする機会でもあったのではないかと。</li>
<li>CakePHPコアデベロッパーのグラハムが、昨年よりも多くの質問がきたり、声をかけてくれる人が増えたけど何かしたの？と驚いていた。これまでに公開されたblogの記事をいくつか読んで感じたのは、せっかくの機会なので交流を持とうと思ってくれていた人の多さでした。海外のコアデベロッパーに会うには、もちろん海外のカンファレンスに行くのが近道です。ただ参加費や言葉の問題などを考えると簡単ではありません。PHPMatsuriではそういった開発者にも交流の機会を作りたいという思いもあるので、それは今回とても参加者の熱意に感謝しているところであります。</li>
</ol>

<p>PHPMatsuriは1月ぐらいから、少しずつ準備が始まり、3月の震災以降開催場所の検討やイベントの内容などオンラインで様々なスタッフ協議が行われてきました。来年のことを現時点で考えられないぐらい抜け殻になっている青年団がほとんどだと思いますが、コメントボードに書かれていた熱い想いを受け止めていければなぁと思います。  </p>

<p>まぁ偶然とは言え、ハッカー賞、次点が某方面で出ましたので、そういう流れなのかもしれませんが、またお知らせができるときがくるまで、各地の勉強会・開発合宿・カンファレンスなどで盛り上がって行ければなぁと思っています。  </p>

<p><a href="http://www.flickr.com/photos/zatsu/6260527568/"><img src="http://farm7.static.flickr.com/6051/6260527568_8a2c658fef.jpg" /></a></p>

<p>本記事中の写真は<a href="http://www.flickr.com/photos/koyhoge/sets/72157627775049941/">@koyhoge</a>さん、<a href="http://www.flickr.com/photos/zatsu/6259999717/in/set-72157627805074311">@suzuki</a>さんのflickrよりお借りしています。  </p>

<p>イベント全体の様子は、アルバムサイトを是非ご覧下さい。</p>



    
    <div class="row">
      <div class="small-12 medium-5 large-5 small-centered columns blog-social">
        <ul class="social-buttons cf">
          <li>
            <a href="http://twitter.com/share" class="socialite twitter-share" data-text="PHPMatsuriで"できたこと"" data-url="http://blog.open.tokyo.jp/2011/10/20/phpmatsuri-3.html" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
          </li>
          <li>
            <a href="https://plus.google.com/share?url=http://blog.open.tokyo.jp/2011/10/20/phpmatsuri-3.html" class="socialite googleplus-one" data-size="tall" data-href="http://blog.open.tokyo.jp/2011/10/20/phpmatsuri-3.html" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
          </li>
          <li>
            <a href="http://www.facebook.com/sharer.php?u=http://blog.open.tokyo.jp/2011/10/20/phpmatsuri-3.html&t=PHPMatsuri%E3%81%A7%22%E3%81%A7%E3%81%8D%E3%81%9F%E3%81%93%E3%81%A8%22" class="socialite facebook-like" data-href="http://blog.open.tokyo.jp/2011/10/20/phpmatsuri-3.html" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
          </li>
        </ul>
      </div>
      <div class="clearfix"></div>
    </div>

  </div>
  <h2 class="title"><a href="/2011/10/09/phpsh-cake.html">phpshでCakeを試食する</a></h2>
  <p class="postdate"><a title="Permanent link" href="/2011/10/09.html">Sunday, October 09, 2011 05:10:48 PM</a></p>
  <p class="tags">
    
      <a rel="tag" href="/tags/cakephp.html">CakePHP</a>
    
      <a rel="tag" href="/tags/phpsh.html">phpsh</a>
    
  </p>
  <div class="content">
    <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
    <p>&lt;!&ndash; more &ndash;&gt;<img src="/images/blog/taste-cake.png" /> </p>

<p>普段 Rails でプログラミングをしていて、便利だなぁと思う機能の１つに</p>
<pre class="highlight plaintext">rails c
</pre>

<p>があります。</p>

<p>コマンドラインからRailsアプリケーションのコードを実行できるコンソールで、コードをファイルに書かなくてもすぐ試せるので「あれっ、こんな書き方で良いのだっけ？」という事をお手軽に試すことができます。  </p>

<p>Rubyにはirbといった対話型ツールもあります。PHPではこれに相当するものは php -q などが標準で使えるのですが、イマイチな使い勝手です。  </p>

<p>そんな中、facebookから公開されている「phpsh」を知りました。これはPHPの対話型ツールで、いわゆるPHP版のirbみたいなものです。</p>

<p>phpshは<a href="http://www.phpsh.org/">http://www.phpsh.org/</a>で、コードはgithubで公開されています。</p>

<p>今回はphpsh自体のコードをハックすることなく、オートローダー用のphpファイルを作成して、CakePHPのコードを動かせるようにしてみました。</p>

<h3>Taste</h3>

<p>この対話型ツールでできることは、実際の製品コードを試す、ケーキで言えば&ldquo;試食&quot;ということで「Taste」と名付けました。  </p>

<p><a href="https://github.com/sizuhiko/Taste">https://github.com/sizuhiko/Taste</a></p>

<h3>インストール</h3>

<p>事前にphpshをインストールしておいてください。インストール方法はgithubのREADMEに書かれているので簡単にできると思います。ちなみに私の環境ではphpshのzipをダウンロードして、以下のコマンドを実行しました。</p>
<pre class="highlight plaintext">python setup.py install --prefix=/usr/local
</pre>

<p>.bashrcに以下の行を追加</p>
<pre class="highlight plaintext">export PYTHONPATH=/usr/local/lib/python2.6/site-packages 
</pre>

<p>後はTasteをインストールします。これはgithubで公開している taste.php を CakePHP のルートディレクトリにコピーするだけです。</p>

<h3>実行</h3>

<p>phpshは &ndash;prefixを付けたディレクトリ/bin にインストールされます。仮にそのディレクトリにパスが通っているとして、以下のコマンドを実行します。</p>
<pre class="highlight plaintext">phpsh taste.php
</pre>

<p><img src="/images/blog/taste-cake-2.png" /></p>

<ol>
<li>私の環境では pcntl をインストールしていないので赤字で出ますが、phpshとしては必須ではないので気にしなくていいです。</li>
<li>ログディレクトリのワーニングが出ますが、コンソールのブートストラップを参考していて出ています。こちらも試食には問題ないのでスルーします。</li>
</ol>

<h3>できること</h3>

<p>CakePHPのコアクラスや、appに配置されたアプリケーションのコードを試すことができます。それは普通に.phpのコードに書いているのと同じ感覚でできます。
では、おなじみのBlogチュートリアルを作った場合、どんな結果が得られるのか見てみましょう。</p>

<h4>モデルクラスを使ってみる</h4>

<p>phpshのコンソールでClassRegistryを使ってモデルを取得し、findしてみます。</p>
<pre class="highlight plaintext">php&gt; $post = ClassRegistry::init('Post');
php&gt; $data = $post-&gt;find('all');
</pre>

<p>以下のように、色付きで表示することができます。<img src="/images/blog/taste-cake-3.png" />   </p>

<h4>URLを実行してみる</h4>

<p>通常のブラウザから実行したときのように Dispatcher クラスを使ってみると、アクションから出力されるhtmlコードを表示してみることができます。</p>
<pre class="highlight plaintext">php&gt; $Dispatcher = new Dispatcher('/posts');
</pre>

<p><img src="/images/blog/taste-cake-4.png" /> </p>

<h4>Routerを使って、URLルーティングを試す</h4>
<pre class="highlight plaintext">php&gt; echo Router::url(array('controller'=&gt;'posts', 'action'=&gt;'index'), false);
/posts
</pre>

<h3>さいごに</h3>

<p>このようにphpshからCakePHPを使ってみれば、製品コード上でvar_dumpして確認する必要もありません（ここ重要）。  </p>

<p>また、ここで紹介した使い方はほんの一片なので、実際にはもっと便利に使えるんじゃないかなぁと思っています。  </p>

<p>現在は、アプリケーションはapp限定です。もしapp以外のアプリケーションディレクトリを使っているひとは、taste.php の 39行目 &lsquo;app&rsquo; =&gt; &lsquo;app&rsquo; の値を変更してください。  </p>

<p>CakePHP2.0対応は、そのうちやりたいなぁと思っています&hellip;.</p>



    
    <div class="row">
      <div class="small-12 medium-5 large-5 small-centered columns blog-social">
        <ul class="social-buttons cf">
          <li>
            <a href="http://twitter.com/share" class="socialite twitter-share" data-text="phpshでCakeを試食する" data-url="http://blog.open.tokyo.jp/2011/10/09/phpsh-cake.html" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
          </li>
          <li>
            <a href="https://plus.google.com/share?url=http://blog.open.tokyo.jp/2011/10/09/phpsh-cake.html" class="socialite googleplus-one" data-size="tall" data-href="http://blog.open.tokyo.jp/2011/10/09/phpsh-cake.html" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
          </li>
          <li>
            <a href="http://www.facebook.com/sharer.php?u=http://blog.open.tokyo.jp/2011/10/09/phpsh-cake.html&t=phpsh%E3%81%A7Cake%E3%82%92%E8%A9%A6%E9%A3%9F%E3%81%99%E3%82%8B" class="socialite facebook-like" data-href="http://blog.open.tokyo.jp/2011/10/09/phpsh-cake.html" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
          </li>
        </ul>
      </div>
      <div class="clearfix"></div>
    </div>

  </div>

  <p class="pagenav">
    
      <a href="/page/5/">« Prev</a>
    
    
      
        
        <a href="/page/2/">2</a>
      
    
      
        
        <a href="/page/3/">3</a>
      
    
      
        
        <a href="/page/4/">4</a>
      
    
      
        
        <a href="/page/5/">5</a>
      
    
      
        <b>6</b>
      
    
      
        
        <a href="/page/7/">7</a>
      
    
      
        
        <a href="/page/8/">8</a>
      
    
      
        
        <a href="/page/9/">9</a>
      
    
      
        
        <a href="/page/10/">10</a>
      
    
    
      <a href="/page/7/">Next »</a>
    
  </p>
<script type="text/javascript" src="/javascripts/image-resize-ie.js"></script>


          

        </div>
      </div>

      <div id="sidewrap">
        <div id="side">
          <div class="sidebox sidelinx">
            <h2>Recent Articles</h2>
            <div class="pad">
              <ul>
                
                  <li><a href="/2014/09/23/cakefest-2014-report.html">CakeFest2014に参加しました</a> <span>2014/09/23</span></li>
                
                  <li><a href="/2014/09/13/cakephp3_debugkit_require_sqlite.html">CakePHP3(Beta1)のDebugKitではSQLiteが必要になります</a> <span>2014/09/13</span></li>
                
                  <li><a href="/2014/09/07/cakephp_ci_book.html">CakePHPで学ぶ継続的インテグレーションが発売されます</a> <span>2014/09/07</span></li>
                
                  <li><a href="/2014/08/17/cakephp2_plugin_travis.html">CakePHP2のプラグインをTravis.ciで継続的インテグレーションする</a> <span>2014/08/17</span></li>
                
                  <li><a href="/2014/06/27/cake3_mokumoku_5.html">CakePHP3 もくもく会#5 に参加して Model の新機能を試してきた</a> <span>2014/06/27</span></li>
                
                  <li><a href="/2014/04/19/twfm_2014_04.html">Test the Web Forward Meetup (仮), Tokyo#2 に参加して Shadow DOM のテストを書いてきた</a> <span>2014/04/19</span></li>
                
                  <li><a href="/2014/04/19/cake3_mokumoku_3.html">CakePHP3 もくもく会#3 に参加して Bake してきた</a> <span>2014/04/19</span></li>
                
                  <li><a href="/2014/03/30/composer-autoload.html">Composerのautoloadを使いこなす</a> <span>2014/03/30</span></li>
                
                  <li><a href="/2014/03/22/web-testing-2014.html">テスト駆動web開発勉強会 Vol.1で発表しました</a> <span>2014/03/22</span></li>
                
                  <li><a href="/2014/03/08/cakephp-addprefix-here-problem.html">CakePHPで動的にプレフィックスルーティングを追加したときに気をつけること</a> <span>2014/03/08</span></li>
                
              </ul>
            </div>
          </div>
          <div class="sidebox" id="tagcloud">
            <h2>Tags</h2>
            <div class="pad">
                
              <ul class="nobullets clearfix">
                
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                    <li class="size2">
                      <a rel="tag" href="/tags/coverflow.html">CoverFlow</a>
                    </li>
                  
                  
                
                  
                  
                    <li class="size2">
                      <a rel="tag" href="/tags/flex.html">Flex</a>
                    </li>
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                    <li class="size0">
                      <a rel="tag" href="/tags/1-2.html">1.2</a>
                    </li>
                  
                  
                
                  
                  
                    <li class="size5">
                      <a rel="tag" href="/tags/cakephp.html">CakePHP</a>
                    </li>
                  
                  
                
                  
                  
                  
                
                  
                  
                    <li class="size0">
                      <a rel="tag" href="/tags/rc1.html">RC1</a>
                    </li>
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                    <li class="size1">
                      <a rel="tag" href="/tags/fixture.html">fixture</a>
                    </li>
                  
                  
                
                  
                  
                    <li class="size3">
                      <a rel="tag" href="/tags/php.html">PHP</a>
                    </li>
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                    <li class="size0">
                      <a rel="tag" href="/tags/phpstudy.html">phpstudy</a>
                    </li>
                  
                  
                
                  
                  
                  
                
                  
                  
                    <li class="size0">
                      <a rel="tag" href="/tags/cakematsuri.html">cakematsuri</a>
                    </li>
                  
                  
                
                  
                  
                    <li class="size2">
                      <a rel="tag" href="/tags/bdd.html">BDD</a>
                    </li>
                  
                  
                
                  
                  
                    <li class="size2">
                      <a rel="tag" href="/tags/behat.html">Behat</a>
                    </li>
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                    <li class="size0">
                      <a rel="tag" href="/tags/cakefest.html">CakeFest</a>
                    </li>
                  
                  
                
                  
                  
                    <li class="size0">
                      <a rel="tag" href="/tags/phpmatsuri.html">phpmatsuri</a>
                    </li>
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                    <li class="size0">
                      <a rel="tag" href="/tags/bddplugin.html">BddPlugin</a>
                    </li>
                  
                  
                
                  
                  
                    <li class="size0">
                      <a rel="tag" href="/tags/spec.html">Spec</a>
                    </li>
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                    <li class="size1">
                      <a rel="tag" href="/tags/test.html">Test</a>
                    </li>
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                    <li class="size0">
                      <a rel="tag" href="/tags/co-edo.html">Co-Edo</a>
                    </li>
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
                  
                  
                  
                
              </ul>
            </div>
          </div>
          <div class="sidebox sidelinx">
            <h2>By Year</h2>
            <div class="pad">
              <ul>
                
                  <li><a href="/2014.html">2014</a> (13)</li>
                
                  <li><a href="/2013.html">2013</a> (6)</li>
                
                  <li><a href="/2012.html">2012</a> (7)</li>
                
                  <li><a href="/2011.html">2011</a> (11)</li>
                
                  <li><a href="/2010.html">2010</a> (3)</li>
                
                  <li><a href="/2009.html">2009</a> (10)</li>
                
                  <li><a href="/2008.html">2008</a> (16)</li>
                
              </ul>
            </div>
          </div>
          <div class="sidebox sidelinx">
            <h2>Twitter</h2>
            <a class="twitter-timeline" href="https://twitter.com/sizuhiko" data-widget-id="442558418625114112">@sizuhiko からのツイート</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
          </div>
        </div>
      </div>

      <div id="footer">
        <div id="footer2">
          <div class="clear"></div>
        </div>
    </div>
  </body>
</html>
