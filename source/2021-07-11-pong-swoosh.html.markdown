---
title: オンラインイベントの盛り上がりを効果音で共有するサービス pong-swoosh を作成した
date: 2021-07-11 08:40 UTC
tags:
- OnlineTool
- Svelte
- Socket.io
---

前回のBlog更新が1年半近く前の、最後のオフラインイベントだったでしょうか....
それから、書くまでもありませんが、イベントや仕事がすべてオンラインで行われるようになりました。

私たちインターネットに関連する仕事をしているものは、特に在宅でも同じように仕事を進めています（僕の場合は家の環境が劣悪というのはありますが）。

変わったのは勉強会やカンファレンス、コミュニティ活動がオンラインになったり、そもそも開催されなくなったりといったことがあります。

僕も昨年中はずっとモチベーションもダダ下がりで、ただ仕事をして何となくYoutubeで動画見るみたいな繰り返しを送っていました。
オンラインの勉強会やカンファレンスにも参加する気になれなかった、というのが本当のところです。

お前は懇親会とか飲み会メインだろ？とか言われると、まぁ否定もできないのですが、リアルな共感が得られない（廊下カンファレンスができない）とか、ちゃんとした理由もあったりします。
僕は必ず前方の席で参加するし、リアクションも他の人と比べるとある方かなーと思っています。
オンラインは、どうしても講義形式になりがちだし、参加している人同士がこういうことに関心があるんだとか、面白いと思ったり感動したりするんだな、ということは得られないな、と思っています。
もちろんチャットやTwitterなど、文字と盛り上がりが共有できたり、ログとして残ったりするんですが、どうしてもWeb会議システムで登壇者の顔、スライドを観ながらチャットも、となると注意力が分散したり、スクリーン数の限界とかにも達するなーと思っています。

目は2つしかない。

### 社内勉強会きっかけ

さて少し話題は変わりますが、僕は所属している会社でIoT勉強会というのを主催していて、これまでトイレ利用状況可視化サービス[Toilet Evolution](https://toiletevolution.space/#/about)、常駐先などから社員証で出退勤できるデバイスとサービス[dakoku](https://github.com/its-succ/dakoku-web)といったものを開発してきました。
IoT勉強会はデバイスなんかを作ることもあったので、会社で購入した工具なんかを共有で使ったりしていたわけですが、同様にオンラインとなると難しくなります。
そこで、何とかオンライン時代のサービスをIoTという文脈で作り出せないかな、と思い続けてきて今回の効果音共有サービスを開発するに至りました。
IoTはモノのインターネットですが、オンラインイベントに参加する盛り上がりや人の感情をモノと見立てて、インターネットで共有するのがオンラインイベントでは有益なのでは？と思っています。

## pong-swoosh

在宅になって、ずっとFMラジオを聴きながら仕事をしていたりするのですが、DJの人が拍手なんかをサウンドマシーンで出すシーンがありますよね。
あれを `ポン出し` なんて言ったりします。
今回作ったサービスは、ポン（効果音）を投げる（チャットの文字送信みたいなイメージ）というところから、pong swoosh という名前にしました。
（日本酒が好きだからポンシュ、なんてことじゃないです。）


## どんなサービスか

pong-swooshは、Web会議システムを利用しながら効果音を送受信して、盛り上がりを共有するシステムです。
使い方は簡単なので、まずは使ってみましょう。

### まずはチャンネルを作成する

チャンネルとは効果音を共有する部屋の単位です。pong-swooshは効果音チャットシステムのようなものなので、チャットでよく使うチャンネルという単語を利用しています。

[トップページ](https://its-succ.github.io/pong-swoosh/)にアクセスして、チャンネル名を入力して作成します。

![](/images/blog/pong-swoosh-top.png)

そうすると、チャンネルのURLが表示されるので、これを参加者に共有します。
1URLだけなので、イベントサイトだったり、Web会議のチャットだったりで共有できますね。

![](/images/blog/pong-swoosh-created.png)

コピーアイコンで簡単にクリップボードにもコピーできます。

### 参加者がアクセスする

共有されたURLにアクセスすると、エントランスページが表示されます。

![](/images/blog/pong-swoosh-entrance.png)

pong-swooshには

- コントローラー画面（効果音を送信する画面
- スピーカー画面（効果音を再生する画面

というものがあります。
なぜ画面を分けたか？というのには理由があります。

オンラインでイベントに参加すると、参加者一覧の画面と、スライドなど画面共有された画面の2つを常に表示していると思います。
かなり大きなディスプレイを使っていれば、余裕があるかもしれないのですが、ノートPCとそれほど大きくない外部モニターだと、それぞれが最大表示されていて、画面には余白がないのでは？と思います（私もそうです）。

そこで、コントローラー画面はスマホでアクセスして利用しやすいように設計されています。
スピーカー画面は、最初に音量調整すれば特に前面に表示している必要がないので、Web会議システムと同じPCで開くことが想定されています。
もちろんWeb会議の音と混じるのが嫌な人もいると思うので、どちらもスマホからアクセスしやすいようにQRコードを表示するようにしています。

### コントローラー画面

このスクショは、PullRequest中のものなので、この記事を読んですぐ試した方は違う画面になります（近いうちに変わります）。

<img src="https://user-images.githubusercontent.com/132000/125040797-01ed9200-e0d3-11eb-813d-9def687f7c9a.png" width="300px" border="1">

コントローラー画面には効果音を参加者に共有(送信)するボタンと、実際にどんな音が鳴るのか送信せずに確認する `視聴` リンクがあります。

### スピーカー画面

このスクショも、PullRequest中のものなので、この記事を読んですぐ試した方は違う画面になります（近いうちに変わります）。

![](https://user-images.githubusercontent.com/132000/125053337-f48ad480-e0df-11eb-9c2e-77dbfb522b47.png)

ボリュームのスライダーがあるので、各自の環境に応じて音量を調整できます。
音量は参加者の人数と同じ効果音を同時(1秒以内)にリアクションした人の数で変化します。
計算式は以下のとおりです。

> Math.sin(Math.PI * 90 * (同時にリアクションした人の数 / チャンネル参加者数) /180) * 2;

最初は直線的に音量が上がるようになっていたのですが、途中から円弧に沿って上がるように変更しています。
同時にリアクションした人の数を集計するのに、RedisのINCR/DECRコマンドを使っています。
チャンネル名と効果音IDをキーにINCRで人数を加算して、1秒後にDECRするといったことで音量が変化します。

### 技術的な話

前にも書きましたが、pong-swooshは効果音チャットシステムのようなものです。
サーバーとの送受信には[socket.io](https://socket.io/)が使われていて、効果音が送信されてくるとチャンネル参加者にブロードキャストされます。
簡単なチャットプログラムを作ったことがあれば容易に想像できるシステムです。
バックエンドはNode.jsで書かれていて、現在はHeroku（無料プラン）にデプロイされています。
フロントエンドはSvelteを使っていて、GitHub Pagesにデプロイされています。
バックエンドは手動デプロイですが、フロントエンドはGitHub Actionsでmainにマージされると自動的にデプロイされるようになっています。

勉強会メンバーで開発していますが、ソースコードは公開されています。
https://github.com/its-succ/pong-swoosh

### さいごに

pong-swooshは、現在自分が担当しているプロジェクトのスクラムイベントと、会社の部門メンバーが月一で集まるミーティングで利用して改善を重ねてきました。
スプリントレビューのデモや、ふりかえり、プレゼンテーションなどの場で効果音を使ってリアクションを共有しています。

それまでは画面越しに拍手をしてみたり（音は出さず映像で）だったのですが、pong-swooshを使うことで賑やかになったといったフィードバックをもらったりしています。

もちろんこういった共有の方法が合う場面、合わない場面などあるかもしれないのですが、もし興味があれば使ってみてください。
そんなに重い処理もないので、Herokuの無料枠で使ってもらっていても問題ないかな？と思っています。

もし使ってみてフィードバックがあれば、GitHubのissueなどに報告してもらえると嬉しいです。
もちろんPRという形で参加いただくのもWelcomeです。

いつかオフラインで昔のように勉強会やカンファレンスができるときが来ると良いのですが、
もうしばらくオンラインが続きそうな感じでもあります。
そんなとき pong-swoosh が少しでもお役に立てれば幸いです。
