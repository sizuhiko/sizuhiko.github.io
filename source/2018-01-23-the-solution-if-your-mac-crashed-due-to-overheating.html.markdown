---
title: MACが熱暴走したときの原因と対応策
date: 2018-01-23 01:15 UTC
tags:
- Mac
---

2017年は、ほとんどアウトプットできなかったので、2018年はBlog書くぞーと思っていたのに、もう23日です。どうも...

さて、皆さんは虹が好きですか？

- 雨が降っていたけど、晴れて虹が出ていた。キレイだねー
- ダブルレインボー珍しい
- ラルクの虹...

とか、まぁ良いイメージあるじゃないですか。
でも マッキントッシュ/Macintosh （通称 Mac）では `虹` は最悪なイメージです。
Windows をお使いの方だと `砂時計` なわけですが、それよりも `虹` になるときは邪悪で、ほぼフリーズに近いです。

## またあいつがやってきた

当方は MacBook Pro(13-inch,2017)、機種IDでいうと `MacBookPro14,1` を使っています。本記事執筆時点の最新版は `MacBookPro14,2` です。

半年ぐらい前か、頻繁にMacがフリーズすることがあって、そのときは `Docker for Mac` が「応答なし」状況になっていたので、よく「Docker不安定だわー」とつぶやいていました。

そうしたら親切なフォロワーさんが「それ `Docker for Mac Edge` でしょ。安定板は大丈夫ですよ」と教えてくれたので、ここ最近はフリーズとはおさらばしていたのです。

しかし年が明けて、頻繁にフリーズするようになりました。
仕事にならん...

## どうやって死んでいくか

何か操作（特に重いわけでもない）をやっていると、ファンがものすごい勢いで回り始めて、Macは熱くなり、なぜかネットワークインターフェースを使用するプログラム（ブラウザ、Twitterクライアント、Slack、Dockerなど）から「応答なし」になっていきます。次第にマウスポインターはレインボーになり、何も反応しなくなります....

このころ、1日に3回ぐらい、4日間連続ぐらいでフリーズしていたので、イライラMAXになっていました。

## オマエか！？

アクティビティモニターを起動したかったのですが、WiFiタブがあるためなのか開けなくて、その状況でどのプロセスが悪さをしているのかわかりませんでした。
そこでずっとアクティビティモニターを起動しっぱなしにして、検証してみることにしました。

何回かのフリーズでは、うまく確認することができなくて「これMacの不良？」と思っていたのですが、ついに原因と思われる挙動を発見しました。

`mdworker` がCPUを独占している・・・・

そうそしてすぐググりましたよ（残念ながらMacはフリーズしていたので、Androidで）。
「Mac mdworker」みたいなキーワードで検索したところ [Macが熱暴走するときの原因と対処法](http://www.dafuku.com/2014/11/mac-mdworker.html) というサイトが見つかりました。

## 原因は Spotlight ？

そういえば、よく熱暴走する前に `npm install` とか `git clone/pull` 、 `composer install` 、 `docker build` とか実行していたなぁと。新しいファイルが見つかると `Spotlight` がサーチを始めて悪さをするのでしょうか？

とりあえず `Spotlight` でドライブをサーチしないように `Macintosh HD` (SSDなのにHDとはコレいかに？みたいなツッコミどころですが...) を対象外に追加します。
私は Spotlight まったく使っていないので気になりません。

と、ここで Finder のサイドバーに `Macintosh HD` が表示されなかったので [Macintosh HD(ハードディスク)をデスクトップ・Finderに表示する方法 macOS Sierra](https://www.lastday.jp/2012/03/06/how-to-show-hd-on-desktop) というサイトを参考に追加しました。

## どうなったか

それから約1週間、ファンが回りまくることもなくなり、虹も見なくなりました。
作業自体は何も変わっていないので、効果があることは間違いないでしょう。

まぁ今までなんでならなくて、突然新しいMacでなるのかなぁ？
そして、なぜ WiFi に関するプロセスから「応答なし」になっていくのかは不明ですが、CPUとWiFiのチップが近くて熱暴走が伝搬する？とか思い、分解記事を読んでみました。

[新型「MacBook Pro 13インチモデル」の分解・修理は極めて難しいことがiFixitの分解レポートで判明](https://gigazine.net/news/20161102-macbook-pro-2016-teardown/) で見ると、WiFiチップの位置は数字の3か4のキーの裏あたりでしょうか？USB-Cに近い位置です。
赤枠になっているCPUにすごい近いわけではないのですが（まぁ遠いわけでもないけど）。

ともかく `虹` が出なくなって、快適に開発を続けております。

最後に、今年はBlog書くよー
